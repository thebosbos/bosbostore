<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Car Dodge Game</title>
<style>
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #a8dadc, #457b9d);
    overflow-x: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #gameArea {
    position: relative;
    width: 300px;
    height: 500px;
    background: linear-gradient(to top, #3a3a3a, #222);
    border: 5px solid #fff;
    border-radius: 15px;
    overflow: hidden;
    touch-action: none;
  }
  #player {
    position: absolute;
    bottom: 20px;
    left: 120px;
    width: 60px;
    height: 120px;
    background-image: url('https://cdn-icons-png.flaticon.com/512/743/743922.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    transition: left 0.1s ease-out;
  }
  .block {
    position: absolute;
    width: 50px;
    height: 100px;
    background-image: url('https://cdn-icons-png.flaticon.com/512/743/743922.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }
  #startBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1d3557;
    color: white;
    font-size: 1.5rem;
    padding: 15px 40px;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 6px 10px rgba(0,0,0,0.3);
    user-select: none;
    z-index: 10;
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: #f1faee;
    font-size: 1.3rem;
    font-weight: bold;
    text-shadow: 0 0 5px #000;
  }
  #gameOverMsg {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(29, 53, 87, 0.9);
    color: #f1faee;
    font-size: 1.4rem;
    padding: 20px 30px;
    border-radius: 15px;
    text-align: center;
    display: none;
    z-index: 10;
    user-select: none;
  }
  #gameOverMsg button {
    margin-top: 15px;
    background: #e63946;
    border: none;
    padding: 10px 25px;
    color: white;
    font-weight: bold;
    border-radius: 25px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="gameArea" tabindex="0">
  <div id="player"></div>
  <button id="startBtn">Start Game</button>
  <div id="scoreBoard">Score: 0</div>
  <div id="gameOverMsg">
    <div id="finalScore"></div>
    <button id="restartBtn">Restart</button>
  </div>
</div>

<script>
  (() => {
    const gameArea = document.getElementById('gameArea');
    const player = document.getElementById('player');
    const startBtn = document.getElementById('startBtn');
    const scoreBoard = document.getElementById('scoreBoard');
    const gameOverMsg = document.getElementById('gameOverMsg');
    const finalScore = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');

    const gameWidth = gameArea.clientWidth;
    const gameHeight = gameArea.clientHeight;
    const playerWidth = player.clientWidth;
    const playerHeight = player.clientHeight;

    let blocks = [];
    let animationId;
    let isGameRunning = false;
    let score = 0;
    let playerX = (gameWidth - playerWidth) / 2;

    // Touch movement variables
    let initialTouchX = null;

    function createBlock() {
      const block = document.createElement('div');
      block.classList.add('block');
      block.style.top = '-100px';
      const blockX = Math.floor(Math.random() * (gameWidth - 50));
      block.style.left = blockX + 'px';
      gameArea.appendChild(block);
      blocks.push({ el: block, x: blockX, y: -100 });
    }

    function moveBlocks() {
      blocks.forEach((block, index) => {
        block.y += 4 + score * 0.05; // increase speed gradually
        block.el.style.top = block.y + 'px';

        if (block.y > gameHeight) {
          // Remove block if off screen & create new
          block.el.remove();
          blocks.splice(index, 1);
          createBlock();
          score++;
          updateScore();
        }

        // Check collision with player
        if (collision(block)) {
          endGame();
        }
      });
    }

    function collision(block) {
      const playerRect = player.getBoundingClientRect();
      const blockRect = block.el.getBoundingClientRect();

      // Adjust rects relative to gameArea to avoid window scrolling issues
      const gameRect = gameArea.getBoundingClientRect();

      const pLeft = playerRect.left - gameRect.left;
      const pRight = playerRect.right - gameRect.left;
      const pTop = playerRect.top - gameRect.top;
      const pBottom = playerRect.bottom - gameRect.top;

      const bLeft = blockRect.left - gameRect.left;
      const bRight = blockRect.right - gameRect.left;
      const bTop = blockRect.top - gameRect.top;
      const bBottom = blockRect.bottom - gameRect.top;

      return !(pRight < bLeft || pLeft > bRight || pBottom < bTop || pTop > bBottom);
    }

    function updateScore() {
      scoreBoard.textContent = 'Score: ' + score;
    }

    function movePlayer(newX) {
      // Clamp player inside game area
      playerX = Math.min(Math.max(newX, 0), gameWidth - playerWidth);
      player.style.left = playerX + 'px';
    }

    function gameLoop() {
      moveBlocks();
      if (isGameRunning) {
        animationId = requestAnimationFrame(gameLoop);
      }
    }

    function startGame() {
      if (isGameRunning) return;
      score = 0;
      updateScore();
      isGameRunning = true;
      startBtn.style.display = 'none';
      gameOverMsg.style.display = 'none';

      // Reset player position to center
      movePlayer((gameWidth - playerWidth) / 2);

      // Clear old blocks if any
      blocks.forEach(b => b.el.remove());
      blocks = [];

      // Create initial blocks
      for (let i = 0; i < 4; i++) {
        createBlock();
      }

      animationId = requestAnimationFrame(gameLoop);
    }

    function endGame() {
      isGameRunning = false;
      cancelAnimationFrame(animationId);
      finalScore.textContent = `Game Over! Your score: ${score}`;
      gameOverMsg.style.display = 'block';
      startBtn.style.display = 'block';
      startBtn.textContent = 'Start Game';
    }

    // Keyboard control (optional)
    gameArea.addEventListener('keydown', e => {
      if (!isGameRunning) return;
      if (e.key === 'ArrowLeft' || e.key === 'a') {
        movePlayer(playerX - 30);
      } else if (e.key === 'ArrowRight' || e.key === 'd') {
        movePlayer(playerX + 30);
      }
    });

    // Touch controls
    gameArea.addEventListener('touchstart', e => {
      if (!isGameRunning) return;
      initialTouchX = e.touches[0].clientX;
    });

    gameArea.addEventListener('touchmove', e => {
      if (!isGameRunning) return;
      e.preventDefault();
      const touchX = e.touches[0].clientX;
      const deltaX = touchX - initialTouchX;
      initialTouchX = touchX;

      movePlayer(playerX + deltaX);
    }, { passive: false });

    // Mouse control for desktop drag (optional)
    let isDragging = false;
    gameArea.addEventListener('mousedown', e => {
      if (!isGameRunning) return;
      isDragging = true;
    });
    window.addEventListener('mouseup', () => {
      isDragging = false;
    });
    gameArea.addEventListener('mousemove', e => {
      if (!isGameRunning || !isDragging) return;
      const rect = gameArea.getBoundingClientRect();
      let newX = e.clientX - rect.left - playerWidth / 2;
      movePlayer(newX);
    });

    // Start button handlers
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', () => {
      gameOverMsg.style.display = 'none';
      startGame();
    });
  })();
</script>

</body>
</html>
